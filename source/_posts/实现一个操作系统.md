---
title: 实现一个操作系统
date: 2019-07-26 12:50:49
categories:
- 造轮子系列
tags: [操作系统]
---

为什么要实现一个操作系统
* 更好的理解操作系统的工作原理
* 锻炼阅读源码的能力
* 学习经典的设计思想
* 时刻要思考一个最重要的问题，为了实现这个目标，用到了哪些方法，哪些思维方式

终极目标
自己写的操作系统能够在真机上运行（比如树莓派），并且自己实现一套GUI

实现一个操作系统的第一步：搭建基础的开发环境

前提：在x86架构上实现一个操作系统

参考
ucore及其实现
Linux开发
[Xv6, a simple Unix-like teaching operating system](https://pdos.csail.mit.edu/6.828/2012/xv6.html)
[osdever](https://wiki.osdev.org/Main_Page)
[内存管理：理解保护模式和分段机制](https://www.bookstack.cn/read/simple_os_book/zh-chapter-1-protect_mode.md)


需要明白以下问题
1.需要一个x86真机或模拟一个x86硬件，如何模拟，如何在真机上运行，二者有何差异
2.搞明白什么是x86
3.什么是x86汇编，什么是Linux 汇编
4.数字电路的基础知识(不是开发操作系统的主要目的，但是能帮助你更好地理解硬件的工作原理)

一、准备知识

硬件模拟器
C语言开发环境：GCC或IDE
源码分析工具：understand
软件开发的版本管理：git

参考资料
[Introduction to reverse engineering and Assembly.](http://kakaroto.homelinux.net/2017/11/introduction-to-reverse-engineering-and-assembly/)
[x86 Assembly Guide](http://www.cs.virginia.edu/~evans/cs216/guides/x86.html)
[汇编](http://www.ruanyifeng.com/blog/2018/01/assembly-language-primer.html)
[Linux 汇编语言开发指南](https://www.ibm.com/developerworks/cn/linux/l-assembly/index.html)

----

1.磁盘基础知识
计算机读写数据的时候，并不是一个字节一个字节的读写，而是以512个字节为单位进行读写。
每512个字节称为一个扇区。如果第一个扇区的最后两个字节是55 AA，则表明该磁盘有启动程序。（55 AA是认为规定的）

2.寄存器概览
CPU只负责计算不负责数据存储。CPU需要到内存中区读写数据。因为CPU和内存之间存在巨大的速度差异，所以CPU中有一、二级缓存，来解决寻址带来的时间损耗。
CPU将常用的最频繁读写的数据存放到寄存器中。寄存器不依靠地址来区分数据，每一个寄存器有自己的名称，CPU根据寄存器的名称查找数据

寄存器的种类
早期的x86 CPU只有8个寄存器，而且每个都有不同的用处。现在CPU中有100多个寄存器，每个寄存器不在指定特定的用途，称为通用寄存器，担扔沿用早期寄存器的名称
```
* EAX
* EBX
* ECX
* EDX
* EDI
* ESI
* EBP
* ESP
```
32位、64位CPU是指寄存器的大小。如：32位CPU是指CPU中的寄存器是4个字节

3.内存模型概览
内存是如何存储数据的？


4.CPU指令
将C语言转换为汇编语言


5.汇编概览
汇编语言是二进制指定的文本形式，与指令一一对应。如```00000011```写成汇编语言就是```ADD```
在Linux下进行开发，需要遵循GNU C的语法和GNU汇编。
GNU汇编采用AT&T汇编格式，Microsoft汇编采用Intel格式
DOS/Windows 下的汇编代码都是 Intel 风格的。
Unix和Linux下的汇编代码是 AT&T 风格


6.make和Makefile
make
make是linux中的一个常用命令，在当前目录下，输入make，系统会自动在当前目录中寻找名为Makefile或makefile的文件，并对之进行解释处理，完成其指定功能；
参考左耳朵耗子的系列文章 [跟我一起写 Makefile](https://blog.csdn.net/haoel/article/details/2886)



7.gdb的使用
参考左耳朵耗子的系列文章[用GDB调试程序](https://blog.csdn.net/haoel/article/details/2879)

8.使用Qemu模拟x86 硬件
